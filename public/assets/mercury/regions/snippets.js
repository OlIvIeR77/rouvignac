(function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};this.Mercury.Regions.Snippets=function(e){function n(e,t,i){this.element=e,this.window=t,this.options=null!=i?i:{},Mercury.log("building "+r,this.element,this.options),n.__super__.constructor.apply(this,arguments),this.makeSortable()}var r;return t(n,e),n.supported=document.getElementById,n.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",r="snippets",n.prototype.type=function(){return r},n.prototype.build=function(){var e,t,n,r;for(r=this.element.find("[data-snippet]"),t=0,n=r.length;n>t;t++)e=r[t],jQuery(e).attr("data-version",0);return"0px"===this.element.css("minHeight")?this.element.css({minHeight:20}):void 0},n.prototype.bindEvents=function(){return n.__super__.bindEvents.apply(this,arguments),Mercury.on("unfocus:regions",function(e){return function(){return e.previewing?void 0:Mercury.region===e?(e.element.removeClass("focus"),e.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:e})):void 0}}(this)),Mercury.on("focus:window",function(e){return function(){return e.previewing?void 0:Mercury.region===e?(e.element.removeClass("focus"),e.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:e})):void 0}}(this)),this.element.on("mouseup",function(e){return function(){return e.previewing?void 0:(e.focus(),Mercury.trigger("region:focused",{region:e}))}}(this)),this.element.on("dragover",function(e){return function(t){return e.previewing?void 0:(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("drop",function(e){return function(t){return!e.previewing&&Mercury.snippet?(e.focus(),t.preventDefault(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)):void 0}}(this)),jQuery(this.document).on("keydown",function(e){return function(t){if(!e.previewing&&Mercury.region===e)switch(t.keyCode){case 90:if(!t.metaKey)return;return t.preventDefault(),t.shiftKey?e.execCommand("redo"):e.execCommand("undo")}}}(this)),jQuery(this.document).on("keyup",function(e){return function(){return e.previewing||Mercury.region!==e?void 0:Mercury.changes=!0}}(this))},n.prototype.focus=function(){return Mercury.region=this,this.makeSortable(),this.element.addClass("focus")},n.prototype.togglePreview=function(){return this.previewing?this.makeSortable():(this.element.sortable("destroy"),this.element.removeClass("focus")),n.__super__.togglePreview.apply(this,arguments)},n.prototype.execCommand=function(e,t){var r;return null==t&&(t={}),n.__super__.execCommand.apply(this,arguments),(r=Mercury.Regions.Snippets.actions[e])?r.call(this,t):void 0},n.prototype.makeSortable=function(){return this.element.sortable("destroy").sortable({document:this.document,scroll:!1,containment:"parent",items:"[data-snippet]",opacity:.4,revert:100,tolerance:"pointer",beforeStop:function(){return function(){return Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0}),!0}}(this),stop:function(e){return function(){return setTimeout(function(){return e.pushHistory()},100),!0}}(this)})},n.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertSnippet:function(e){var t,n;return n=e.value,(t=this.element.find("[data-snippet="+n.identity+"]")).length?t.replaceWith(n.getHTML(this.document,function(e){return function(){return e.pushHistory()}}(this))):this.element.append(n.getHTML(this.document,function(e){return function(){return e.pushHistory()}}(this)))},editSnippet:function(){var e;if(this.snippet)return e=Mercury.Snippet.find(this.snippet.data("snippet")),e.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},n}(Mercury.Region)}).call(this);